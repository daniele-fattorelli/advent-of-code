
const input = [ ["inp", "w"], ["mul", "x", "0"], ["add", "x", "z"], ["mod", "x", "26"], ["div", "z", "1"], ["add", "x", "12"], ["eql", "x", "w"], ["eql", "x", "0"], ["mul", "y", "0"], ["add", "y", "25"], ["mul", "y", "x"], ["add", "y", "1"], ["mul", "z", "y"], ["mul", "y", "0"], ["add", "y", "w"], ["add", "y", "9"], ["mul", "y", "x"], ["add", "z", "y"], ["inp", "w"], ["mul", "x", "0"], ["add", "x", "z"], ["mod", "x", "26"], ["div", "z", "1"], ["add", "x", "12"], ["eql", "x", "w"], ["eql", "x", "0"], ["mul", "y", "0"], ["add", "y", "25"], ["mul", "y", "x"], ["add", "y", "1"], ["mul", "z", "y"], ["mul", "y", "0"], ["add", "y", "w"], ["add", "y", "4"], ["mul", "y", "x"], ["add", "z", "y"], ["inp", "w"], ["mul", "x", "0"], ["add", "x", "z"], ["mod", "x", "26"], ["div", "z", "1"], ["add", "x", "12"], ["eql", "x", "w"], ["eql", "x", "0"], ["mul", "y", "0"], ["add", "y", "25"], ["mul", "y", "x"], ["add", "y", "1"], ["mul", "z", "y"], ["mul", "y", "0"], ["add", "y", "w"], ["add", "y", "2"], ["mul", "y", "x"], ["add", "z", "y"], ["inp", "w"], ["mul", "x", "0"], ["add", "x", "z"], ["mod", "x", "26"], ["div", "z", "26"], ["add", "x", "-9"], ["eql", "x", "w"], ["eql", "x", "0"], ["mul", "y", "0"], ["add", "y", "25"], ["mul", "y", "x"], ["add", "y", "1"], ["mul", "z", "y"], ["mul", "y", "0"], ["add", "y", "w"], ["add", "y", "5"], ["mul", "y", "x"], ["add", "z", "y"], ["inp", "w"], ["mul", "x", "0"], ["add", "x", "z"], ["mod", "x", "26"], ["div", "z", "26"], ["add", "x", "-9"], ["eql", "x", "w"], ["eql", "x", "0"], ["mul", "y", "0"], ["add", "y", "25"], ["mul", "y", "x"], ["add", "y", "1"], ["mul", "z", "y"], ["mul", "y", "0"], ["add", "y", "w"], ["add", "y", "1"], ["mul", "y", "x"], ["add", "z", "y"], ["inp", "w"], ["mul", "x", "0"], ["add", "x", "z"], ["mod", "x", "26"], ["div", "z", "1"], ["add", "x", "14"], ["eql", "x", "w"], ["eql", "x", "0"], ["mul", "y", "0"], ["add", "y", "25"], ["mul", "y", "x"], ["add", "y", "1"], ["mul", "z", "y"], ["mul", "y", "0"], ["add", "y", "w"], ["add", "y", "6"], ["mul", "y", "x"], ["add", "z", "y"], ["inp", "w"], ["mul", "x", "0"], ["add", "x", "z"], ["mod", "x", "26"], ["div", "z", "1"], ["add", "x", "14"], ["eql", "x", "w"], ["eql", "x", "0"], ["mul", "y", "0"], ["add", "y", "25"], ["mul", "y", "x"], ["add", "y", "1"], ["mul", "z", "y"], ["mul", "y", "0"], ["add", "y", "w"], ["add", "y", "11"], ["mul", "y", "x"], ["add", "z", "y"], ["inp", "w"], ["mul", "x", "0"], ["add", "x", "z"], ["mod", "x", "26"], ["div", "z", "26"], ["add", "x", "-10"], ["eql", "x", "w"], ["eql", "x", "0"], ["mul", "y", "0"], ["add", "y", "25"], ["mul", "y", "x"], ["add", "y", "1"], ["mul", "z", "y"], ["mul", "y", "0"], ["add", "y", "w"], ["add", "y", "15"], ["mul", "y", "x"], ["add", "z", "y"], ["inp", "w"], ["mul", "x", "0"], ["add", "x", "z"], ["mod", "x", "26"], ["div", "z", "1"], ["add", "x", "15"], ["eql", "x", "w"], ["eql", "x", "0"], ["mul", "y", "0"], ["add", "y", "25"], ["mul", "y", "x"], ["add", "y", "1"], ["mul", "z", "y"], ["mul", "y", "0"], ["add", "y", "w"], ["add", "y", "7"], ["mul", "y", "x"], ["add", "z", "y"], ["inp", "w"], ["mul", "x", "0"], ["add", "x", "z"], ["mod", "x", "26"], ["div", "z", "26"], ["add", "x", "-2"], ["eql", "x", "w"], ["eql", "x", "0"], ["mul", "y", "0"], ["add", "y", "25"], ["mul", "y", "x"], ["add", "y", "1"], ["mul", "z", "y"], ["mul", "y", "0"], ["add", "y", "w"], ["add", "y", "12"], ["mul", "y", "x"], ["add", "z", "y"], ["inp", "w"], ["mul", "x", "0"], ["add", "x", "z"], ["mod", "x", "26"], ["div", "z", "1"], ["add", "x", "11"], ["eql", "x", "w"], ["eql", "x", "0"], ["mul", "y", "0"], ["add", "y", "25"], ["mul", "y", "x"], ["add", "y", "1"], ["mul", "z", "y"], ["mul", "y", "0"], ["add", "y", "w"], ["add", "y", "15"], ["mul", "y", "x"], ["add", "z", "y"], ["inp", "w"], ["mul", "x", "0"], ["add", "x", "z"], ["mod", "x", "26"], ["div", "z", "26"], ["add", "x", "-15"], ["eql", "x", "w"], ["eql", "x", "0"], ["mul", "y", "0"], ["add", "y", "25"], ["mul", "y", "x"], ["add", "y", "1"], ["mul", "z", "y"], ["mul", "y", "0"], ["add", "y", "w"], ["add", "y", "9"], ["mul", "y", "x"], ["add", "z", "y"], ["inp", "w"], ["mul", "x", "0"], ["add", "x", "z"], ["mod", "x", "26"], ["div", "z", "26"], ["add", "x", "-9"], ["eql", "x", "w"], ["eql", "x", "0"], ["mul", "y", "0"], ["add", "y", "25"], ["mul", "y", "x"], ["add", "y", "1"], ["mul", "z", "y"], ["mul", "y", "0"], ["add", "y", "w"], ["add", "y", "12"], ["mul", "y", "x"], ["add", "z", "y"], ["inp", "w"], ["mul", "x", "0"], ["add", "x", "z"], ["mod", "x", "26"], ["div", "z", "26"], ["add", "x", "-3"], ["eql", "x", "w"], ["eql", "x", "0"], ["mul", "y", "0"], ["add", "y", "25"], ["mul", "y", "x"], ["add", "y", "1"], ["mul", "z", "y"], ["mul", "y", "0"], ["add", "y", "w"], ["add", "y", "12"], ["mul", "y", "x"], ["add", "z", "y"] ];

console.log(input);

var Monad = [];
var ParsedMonad = [];
var ZeroResultRules;
var SerialNumber = [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ];
var Result = 0;

for (let i = 0; i < 14; i++) {
    Monad.push({
        "Div":      parseInt(input[i*18+4 ][2]),
        "Offset":   parseInt(input[i*18+5 ][2]),
        "Add":      parseInt(input[i*18+15][2])
    });
}
console.log(Monad);

function ParseMonad(Total, Conditions, i) {

    if (i == 14) {
        ParsedMonad.push({
            "Total": Total,
            "Conditions": Conditions
        });
        return;
    }

    let Condition;
    if (Total.length > 0) {
        Condition = {
            "Input":  Total[0].Input,
            "Offset": Total[0].Offset + Monad[i].Offset,
            "Check":  i
        }
    }
    if (Monad[i].Div > 1) Total.shift();

    if (Condition && Condition.Offset > -9 && Condition.Offset < 9) {

        Conditions.push({
            "Input":  Condition.Input,
            "Offset": Condition.Offset,
            "Check":  Condition.Check,
            "Result": false
        });

        ParseMonad(JSON.parse(JSON.stringify(Total)), JSON.parse(JSON.stringify(Conditions)), i+1);

        Conditions[Conditions.length-1].Result = true;

    }

    Total.splice(0, 0, {
        "Input": i,
        "Offset": Monad[i].Add
    });

    ParseMonad(JSON.parse(JSON.stringify(Total)), JSON.parse(JSON.stringify(Conditions)), i+1);

}

ParseMonad([], [], 0);
console.log(ParsedMonad);

ZeroResultRules = ParsedMonad.filter(m => m.Total.length == 0);
console.log(ZeroResultRules);

function CheckCondition(Condition) {

    if (!Condition) return true;

    let Check = SerialNumber[Condition.Input] + Condition.Offset != SerialNumber[Condition.Check];
    return Condition.Result ? Check : !Check;

}

function ComposeSerialNumber(Conditions, i, Limit, Increment) {

    if (i == 14) {
        let SerialCandidate = 0;
        SerialNumber.forEach((sn, index) => SerialCandidate += sn * Math.pow(10, 13-index));
        if (Increment < 0 ? SerialCandidate > Result : SerialCandidate < Result) Result = SerialCandidate;
        return true;
    }

    SerialNumber[i] = Limit;
    let Condition = Conditions.find(c => c.Input == i && !c.Result);
    while (Condition && (Increment < 0 ? SerialNumber[i] + Condition.Offset > Limit : SerialNumber[i] + Condition.Offset < Limit)) SerialNumber[i] += Increment;

    Condition = Conditions.find(c => c.Check == i);
    while (SerialNumber[i] > 0 && !CheckCondition(Condition)) SerialNumber[i] += Increment;
    while (SerialNumber[i] > 0 && !ComposeSerialNumber(Conditions, i+1, Limit, Increment)) SerialNumber[i] += Increment;

    return SerialNumber[i] != 0;

}

ZeroResultRules.forEach(r => ComposeSerialNumber(r.Conditions, 0, 9, -1));

console.log('Part 1 answer: ' + Result);

Result = 99999999999999;
ZeroResultRules.forEach(r => ComposeSerialNumber(r.Conditions, 0, 1, 1));

console.log('Part 2 answer: ' + Result);
